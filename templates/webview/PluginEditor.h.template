/*
  ==============================================================================

    This file contains the basic framework code for a JUCE plugin editor.

  ==============================================================================
*/

#pragma once

#include <JuceHeader.h>
#include "PluginProcessor.h"
#include "ParameterIDs.hpp"

//==============================================================================
/**
*/
class {{PLUGIN_NAME}}AudioProcessorEditor  : public juce::AudioProcessorEditor
{
public:
    {{PLUGIN_NAME}}AudioProcessorEditor ({{PLUGIN_NAME}}AudioProcessor&);
    ~{{PLUGIN_NAME}}AudioProcessorEditor() override;

    //==============================================================================
    void paint (juce::Graphics&) override;
    void resized() override;

private:
    {{PLUGIN_NAME}}AudioProcessor& audioProcessor;

    // ═══════════════════════════════════════════════════════════════════
    // CRITICAL: Member Declaration Order (Prevents DAW Crashes)
    // ═══════════════════════════════════════════════════════════════════
    //
    // C++ destroys members in REVERSE order of declaration.
    // WebView references relays via .withOptionsFrom()
    //
    // CORRECT ORDER: Relays → WebView → Attachments
    //
    // This ensures WebView is destroyed BEFORE the relays it references,
    // preventing access to freed memory (segfault/crash).
    //
    // See: .claude/troubleshooting/resolutions/webview-member-order-crash.md
    // ═══════════════════════════════════════════════════════════════════

    // 1. PARAMETER RELAYS FIRST (no dependencies, destroyed last)
    // Relays are direct member variables - initialized with parameter ID
    juce::WebSliderRelay {{PARAMETER_NAME}}Relay { ParameterIDs::{{PARAMETER_ID}} };
    {{ADDITIONAL_RELAYS}}

    // 2. WEBVIEW SECOND (depends on relays, destroyed middle)
    std::unique_ptr<juce::WebBrowserComponent> webView;

    // 3. PARAMETER ATTACHMENTS LAST (depend on relays + parameters, destroyed first)
    {{PARAMETER_ATTACHMENTS}}

    // Resource provider function
    std::optional<juce::WebBrowserComponent::Resource> getResource (const juce::String& url);

    // Helper functions for resource provider
    static juce::ZipFile* getZipFile();
    static const char* getMimeForExtension (const juce::String& extension);
    static juce::String getExtension (juce::String filename);
    static auto streamToVector (juce::InputStream& stream);

    JUCE_DECLARE_NON_COPYABLE_WITH_LEAK_DETECTOR ({{PLUGIN_NAME}}AudioProcessorEditor)
};
